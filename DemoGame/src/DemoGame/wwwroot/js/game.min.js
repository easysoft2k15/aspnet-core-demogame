function connectToServer(){return $.connection.hub.start({transport:["webSockets"]},function(){ex.Logger.getInstance().info("Connected to server",hub.connection.id)})}function joinGame(n){hub.server.join(n)}function onSynch(n){for(var t,f,r,e,i,o=[],u=0,s=n;u<s.length;u++)t=s[u],o.push(t.Id),players[t.Id]||onOtherJoined(t.Id,t.Name,t.X,t.Y),players[t.Id].easeTo(t.X,t.Y,150,ex.EasingFunctions.EaseInOutCubic);f=[];for(i in players)players.hasOwnProperty(i)&&o.indexOf(i)===-1&&f.push(i);for(r=0,e=f;r<e.length;r++)i=e[r],onLeave(i)}function onJoined(n,t,i){if(ex.Logger.getInstance().info("Joined",t,i),player){player.connectionId=hub.connection.id;return}player=new MainPlayer(hub.connection.id,n,t,i);players[player.connectionId]=player;game.add(player);game.currentScene.camera.setActorToFollow(player)}function onOtherJoined(n,t,i,r){if(ex.Logger.getInstance().info("Other player joined",n,t,i,r),!players[n]){var u=new Player(n,t,i,r);players[n]=u;game.add(u)}}function onLeave(n){if(ex.Logger.getInstance().info("Player disconnected",n),players[n]){var t=players[n];game.remove(t);delete players[n]}}var __extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},Config={background:ex.Color.Azure,mapSize:1600},Resources={TxMap:new ex.Texture("images/map.png"),TxPlayer:new ex.Texture("images/dude.png")},hub=$.connection.game,player,players,game,loader,r,Player,MainPlayer;hub.client.joined=onJoined;hub.client.otherJoined=onOtherJoined;hub.client.leave=onLeave;hub.client.synch=onSynch;players={};game=new ex.Engine({canvasElementId:"game",displayMode:ex.DisplayMode.FullScreen,pointerScope:ex.Input.PointerScope.Canvas});game.backgroundColor=Config.background;loader=new ex.Loader;for(r in Resources)loader.addResource(Resources[r]);game.start(loader).then(function(){connectToServer();game.currentScene.camera=new ex.LockedCamera;var n=new ex.Actor(0,0,game.getWidth(),game.getHeight());n.anchor.setTo(0,0);n.addDrawing(Resources.TxMap);n.setCenterDrawing(!1);game.add(n)});Player=function(n){function t(t,i,r,u){n.call(this,r,u,32,32);this.connectionId=t;this.name=i}return __extends(t,n),t.prototype.onInitialize=function(t){n.prototype.onInitialize.call(this,t);this.addDrawing(Resources.TxPlayer);var i=new ex.Label(this.name,0,-20,"Arial");i.textAlign=ex.TextAlign.Center;this.add(i)},t}(ex.Actor);MainPlayer=function(n){function t(){n.apply(this,arguments)}return __extends(t,n),t.prototype.update=function(t,i){n.prototype.update.call(this,t,i);t.input.keyboard.wasReleased(ex.Input.Keys.Up)&&hub.server.moveUp();t.input.keyboard.wasReleased(ex.Input.Keys.Down)&&hub.server.moveDown();t.input.keyboard.wasReleased(ex.Input.Keys.Left)&&hub.server.moveLeft();t.input.keyboard.wasReleased(ex.Input.Keys.Right)&&hub.server.moveRight()},t}(Player);